## API Report File for "@interaqt/runtime"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts

import { Activity } from '@interaqt/shared';
import { ActivityGroupInstanceType } from '@interaqt/shared';
import { ActivityGroupPublicType } from '@interaqt/shared';
import { ActivityInstanceType } from '@interaqt/shared';
import { Atom } from 'data0';
import { Attributive } from '@interaqt/shared';
import { BoolExp } from '@interaqt/shared';
import { BoolExpressionRawData } from '@interaqt/shared';
import { Concept } from '@interaqt/shared';
import { ConceptInstance } from '@interaqt/shared';
import cors from 'cors';
import { createClass } from '@interaqt/shared';
import { Entity } from '@interaqt/shared';
import { FastifyLoggerOptions } from 'fastify';
import { GatewayInstanceType } from '@interaqt/shared';
import { GatewayPublicType } from '@interaqt/shared';
import { InertKlassInstance } from '@interaqt/shared';
import { Interaction } from '@interaqt/shared';
import { InteractionInstanceType } from '@interaqt/shared';
import { InteractionPublicType } from '@interaqt/shared';
import { Klass } from '@interaqt/shared';
import { KlassInstance } from '@interaqt/shared';
import { MatchExpressionData } from '@interaqt/storage';
import { Property } from '@interaqt/shared';
import { PropertyTypes } from '@interaqt/shared';
import { ReactiveKlassInstance } from '@interaqt/shared';
import { Relation } from '@interaqt/shared';
import SQLite from 'better-sqlite3';
import { TransferPublicType } from '@interaqt/shared';

// @public (undocumented)
export const ACTIVITY_RECORD = "_Activity_";

// @public (undocumented)
export const activityEntity: InertKlassInstance<    {
name: {
type: "string";
collection: false;
required: true;
constraints: {
nameFormat({ name }: {
name: Atom<string>;
}): Atom<boolean>;
};
};
computedData: {
type: Klass<any>[];
collection: false;
required: false;
};
properties: {
type: Klass<    {
name: {
type: "string";
required: true;
collection: false;
constraints: {
format({ name }: {
name: Atom<string>;
}): Atom<boolean>;
length({ name }: {
name: Atom<string>;
}): Atom<boolean>;
};
};
type: {
type: "string";
required: true;
collection: false;
options: PropertyTypes[];
};
collection: {
type: "boolean";
required: true;
collection: false;
defaultValue(): boolean;
};
args: {
computedType: (values: {
type: PropertyTypes;
}) => string;
};
computedData: {
collection: false;
type: Klass<any>[];
required: false;
};
computed: {
required: false;
type: "function";
collection: false;
};
}>;
collection: true;
required: true;
constraints: {
eachNameUnique({ properties }: any): Atom<boolean>;
};
defaultValue(): never[];
};
isRef: {
required: true;
collection: false;
type: "boolean";
defaultValue: () => boolean;
};
}>;

// @public (undocumented)
export type APIBody = {
    activity?: string;
    interaction?: string;
    activityId?: string;
    payload?: EventPayload;
    query?: EventQuery;
};

// @public (undocumented)
export class Controller {
    constructor(system: System, entities: KlassInstance<typeof Entity, false>[], relations: KlassInstance<typeof Relation, false>[], activities: KlassInstance<typeof Activity, false>[], interactions: KlassInstance<typeof Interaction, false>[], states?: KlassInstance<typeof Property, false>[]);
    // (undocumented)
    activities: KlassInstance<typeof Activity, false>[];
    // Warning: (ae-forgotten-export) The symbol "ActivityCall" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    activityCalls: Map<string, ActivityCall>;
    // (undocumented)
    activityCallsByName: Map<string, ActivityCall>;
    // Warning: (ae-forgotten-export) The symbol "DataContext" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    addComputedDataHandle(computedData: KlassInstance<any, false>, host: DataContext["host"], id: DataContext["id"]): void;
    // (undocumented)
    callActivityInteraction(activityCallId: string, interactionCallId: string, activityId: string, interactionEventArgs: InteractionEventArgs): Promise<InteractionCallResponse>;
    // (undocumented)
    callbacks: Map<any, Set<SystemCallback>>;
    // Warning: (ae-forgotten-export) The symbol "InteractionEventArgs" needs to be exported by the entry point index.d.ts
    // Warning: (ae-forgotten-export) The symbol "InteractionCallResponse" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    callInteraction(interactionId: string, interactionEventArgs: InteractionEventArgs): Promise<InteractionCallResponse>;
    // Warning: (ae-forgotten-export) The symbol "ComputedDataHandle" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    computedDataHandles: Set<ComputedDataHandle>;
    // (undocumented)
    createActivity(activityCallId: string): Promise<{
        activityId: any;
        state: ActivitySeqStateData;
    }>;
    // (undocumented)
    dispatch(event: any, ...args: any[]): Promise<void>;
    // (undocumented)
    entities: KlassInstance<typeof Entity, false>[];
    // (undocumented)
    globals: {
        BoolExp: typeof BoolExp;
    };
    // (undocumented)
    interactionCalls: Map<string, InteractionCall>;
    // Warning: (ae-forgotten-export) The symbol "InteractionCall" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    interactionCallsByName: Map<string, InteractionCall>;
    // (undocumented)
    interactions: KlassInstance<typeof Interaction, false>[];
    // (undocumented)
    listen(event: any, callback: SystemCallback): () => void;
    // (undocumented)
    relations: KlassInstance<typeof Relation, false>[];
    // (undocumented)
    setup(): Promise<void>;
    // (undocumented)
    states: KlassInstance<typeof Property, false>[];
    // (undocumented)
    system: System;
}

// @public (undocumented)
export function createDataAPI(handle: DataAPIHandle, params?: any[]): DataAPI;

// @public (undocumented)
export type DataAPI = DataAPIHandle & {
    params: any[];
};

// @public (undocumented)
export type DataAPIHandle = (this: DataAPIThis, ...rest: any[]) => any;

// @public (undocumented)
export type DataAPIs = {
    [k: string]: DataAPI;
};

// @public (undocumented)
export type DataAPIThis = {
    system: Controller['system'];
    user: EventUser;
};

// @public (undocumented)
export type Database = {
    open: () => Promise<any>;
    scheme: (sql: string, name?: string) => Promise<any>;
    query: <T extends any>(sql: string, values: any[], name?: string) => Promise<T[]>;
    delete: <T extends any>(sql: string, where: any[], name?: string) => Promise<T[]>;
    insert: (sql: string, values: any[], name?: string) => Promise<EntityIdRef>;
    update: (sql: string, values: any[], idField?: string, name?: string) => Promise<EntityIdRef[]>;
    getAutoId: (recordName: string) => Promise<string>;
};

// @public (undocumented)
export type EntityIdRef = {
    id: string;
    [ROW_ID_ATTR]?: string;
    [k: string]: any;
};

// @public (undocumented)
export const EVENT_RECORD = "_Event_";

// @public (undocumented)
export const eventEntity: InertKlassInstance<    {
name: {
type: "string";
collection: false;
required: true;
constraints: {
nameFormat({ name }: {
name: Atom<string>;
}): Atom<boolean>;
};
};
computedData: {
type: Klass<any>[];
collection: false;
required: false;
};
properties: {
type: Klass<    {
name: {
type: "string";
required: true;
collection: false;
constraints: {
format({ name }: {
name: Atom<string>;
}): Atom<boolean>;
length({ name }: {
name: Atom<string>;
}): Atom<boolean>;
};
};
type: {
type: "string";
required: true;
collection: false;
options: PropertyTypes[];
};
collection: {
type: "boolean";
required: true;
collection: false;
defaultValue(): boolean;
};
args: {
computedType: (values: {
type: PropertyTypes;
}) => string;
};
computedData: {
collection: false;
type: Klass<any>[];
required: false;
};
computed: {
required: false;
type: "function";
collection: false;
};
}>;
collection: true;
required: true;
constraints: {
eachNameUnique({ properties }: any): Atom<boolean>;
};
defaultValue(): never[];
};
isRef: {
required: true;
collection: false;
type: "boolean";
defaultValue: () => boolean;
};
}>;

// @public (undocumented)
export const ID_ATTR = "id";

// @public (undocumented)
export class MonoSystem implements System {
    constructor(db?: Database, logger?: SystemLogger);
    // (undocumented)
    conceptClass: Map<string, ReturnType<typeof createClass>>;
    // (undocumented)
    createActivity(activity: any): Promise<any>;
    // (undocumented)
    getActivity(query?: MatchExpressionData): Promise<any[]>;
    // (undocumented)
    getEvent(query?: MatchExpressionData): Promise<InteractionEvent[]>;
    // (undocumented)
    logger: SystemLogger;
    // Warning: (ae-forgotten-export) The symbol "InteractionEvent" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    saveEvent(event: InteractionEvent): Promise<any>;
    // (undocumented)
    setup(entities: KlassInstance<typeof Entity, false>[], relations: KlassInstance<typeof Relation, false>[]): any;
    // (undocumented)
    storage: Storage_2;
    // (undocumented)
    updateActivity(match: MatchExpressionData, activity: any): Promise<any>;
}

// @public (undocumented)
export interface Payload {
    // (undocumented)
    [k: string]: any;
}

// @public (undocumented)
export type RecordChangeListener = (mutationEvents: RecordMutationEvent[]) => any;

// @public (undocumented)
export type RecordMutationEvent = {
    recordName: string;
    type: 'create' | 'update' | 'delete';
    keys?: string[];
    record?: {
        [key: string]: any;
    };
    oldRecord?: {
        [key: string]: any;
    };
};

// @public (undocumented)
export const ROW_ID_ATTR = "_rowId";

// @public (undocumented)
export class SQLiteDB implements Database {
    constructor(file?: string, options?: (SQLite.Options & {
        log: (msg: SQLiteDBLog) => any;
    }) | undefined);
    // (undocumented)
    close(): void;
    // (undocumented)
    db: InstanceType<typeof SQLite>;
    // (undocumented)
    delete(sql: string, where: any[], name?: string): Promise<any[]>;
    // (undocumented)
    file: string;
    // (undocumented)
    getAutoId(recordName: string): Promise<string>;
    // Warning: (ae-forgotten-export) The symbol "IDSystem" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    idSystem: IDSystem;
    // (undocumented)
    insert(sql: string, values: any[], name?: string): Promise<EntityIdRef>;
    // (undocumented)
    log: (msg: SQLiteDBLog) => any;
    // (undocumented)
    open(): Promise<void>;
    // (undocumented)
    options?: (SQLite.Options & {
        log: (msg: SQLiteDBLog) => any;
    }) | undefined;
    // (undocumented)
    query<T extends any>(sql: string, where?: any[], name?: string): Promise<T[]>;
    // (undocumented)
    scheme(sql: string, name?: string): Promise<SQLite.RunResult>;
    // (undocumented)
    update(sql: string, values: any[], idField?: string, name?: string): Promise<any[]>;
}

// @public (undocumented)
export type SQLiteDBLog = {
    type: string;
    name: string;
    sql: string;
    params?: any[];
};

// @public (undocumented)
export type SQLiteDBOptions = Parameters<typeof SQLite>[1] & {
    log: SQLiteDB['log'];
};

// Warning: (ae-forgotten-export) The symbol "ServerOptions" needs to be exported by the entry point index.d.ts
//
// @public (undocumented)
export function startServer(controller: Controller, options: ServerOptions, dataAPIs?: DataAPIs): Promise<void>;

// @public (undocumented)
type Storage_2 = {
    beginTransaction: (transactionName?: string) => Promise<any>;
    commitTransaction: (transactionName?: string) => Promise<any>;
    rollbackTransaction: (transactionName?: string) => Promise<any>;
    get: (itemName: string, id: string, initialValue?: any) => Promise<any>;
    set: (itemName: string, id: string, value: any) => Promise<any>;
    setup: (entities: KlassInstance<typeof Entity, false>[], relations: KlassInstance<typeof Relation, false>[]) => any;
    findOne: (entityName: string, ...arg: any[]) => Promise<any>;
    update: (entityName: string, ...arg: any[]) => Promise<any>;
    find: (entityName: string, ...arg: any[]) => Promise<any[]>;
    create: (entityName: string, data: any) => Promise<any>;
    delete: (entityName: string, data: any) => Promise<any>;
    findOneRelationByName: (relationName: string, ...arg: any[]) => Promise<any>;
    findRelationByName: (relationName: string, ...arg: any[]) => Promise<any>;
    updateRelationByName: (relationName: string, ...arg: any[]) => Promise<any>;
    removeRelationByName: (relationName: string, ...arg: any[]) => Promise<any>;
    addRelationByNameById: (relationName: string, ...arg: any[]) => Promise<any>;
    getRelationName: (...arg: any[]) => string;
    listen: (callback: RecordChangeListener) => any;
};
export { Storage_2 as Storage }

// @public (undocumented)
export interface System {
    // (undocumented)
    conceptClass: Map<string, ReturnType<typeof createClass>>;
    // (undocumented)
    createActivity: (activity: any) => Promise<any>;
    // (undocumented)
    getActivity: (query?: MatchExpressionData) => Promise<any[]>;
    // (undocumented)
    getEvent: (query: any) => Promise<InteractionEvent[]>;
    // (undocumented)
    logger: SystemLogger;
    // (undocumented)
    saveEvent: (interactionEvent: InteractionEvent) => Promise<any>;
    // (undocumented)
    setup: (entities: KlassInstance<typeof Entity, false>[], relations: KlassInstance<typeof Relation, false>[]) => Promise<any>;
    // (undocumented)
    storage: Storage_2;
    // (undocumented)
    updateActivity: (match: MatchExpressionData, activity: any) => Promise<any>;
}

// @public (undocumented)
export const SYSTEM_RECORD = "_System_";

// @public (undocumented)
export type SystemCallback = (...arg: any[]) => any;

// @public (undocumented)
export const systemEntity: InertKlassInstance<    {
name: {
type: "string";
collection: false;
required: true;
constraints: {
nameFormat({ name }: {
name: Atom<string>;
}): Atom<boolean>;
};
};
computedData: {
type: Klass<any>[];
collection: false;
required: false;
};
properties: {
type: Klass<    {
name: {
type: "string";
required: true;
collection: false;
constraints: {
format({ name }: {
name: Atom<string>;
}): Atom<boolean>;
length({ name }: {
name: Atom<string>;
}): Atom<boolean>;
};
};
type: {
type: "string";
required: true;
collection: false;
options: PropertyTypes[];
};
collection: {
type: "boolean";
required: true;
collection: false;
defaultValue(): boolean;
};
args: {
computedType: (values: {
type: PropertyTypes;
}) => string;
};
computedData: {
collection: false;
type: Klass<any>[];
required: false;
};
computed: {
required: false;
type: "function";
collection: false;
};
}>;
collection: true;
required: true;
constraints: {
eachNameUnique({ properties }: any): Atom<boolean>;
};
defaultValue(): never[];
};
isRef: {
required: true;
collection: false;
type: "boolean";
defaultValue: () => boolean;
};
}>;

// @public (undocumented)
export type SystemLogger = {
    error: (arg: SystemLogType) => any;
    warn: (arg: SystemLogType) => any;
    info: (arg: SystemLogType) => any;
    http: (arg: SystemLogType) => any;
    verbose: (arg: SystemLogType) => any;
    debug: (arg: SystemLogType) => any;
    silly: (arg: SystemLogType) => any;
};

// @public (undocumented)
export type SystemLogType = {
    label: string;
    message: string;
    [k: string]: any;
};

// @public (undocumented)
export const USER_ENTITY = "User";

// Warnings were encountered during analysis:
//
// Controller.ts:216:8 - (ae-forgotten-export) The symbol "ActivitySeqStateData" needs to be exported by the entry point index.d.ts
// server.ts:20:5 - (ae-forgotten-export) The symbol "EventPayload" needs to be exported by the entry point index.d.ts
// server.ts:21:5 - (ae-forgotten-export) The symbol "EventQuery" needs to be exported by the entry point index.d.ts
// server.ts:30:5 - (ae-forgotten-export) The symbol "EventUser" needs to be exported by the entry point index.d.ts

// (No @packageDocumentation comment for this package)

```
